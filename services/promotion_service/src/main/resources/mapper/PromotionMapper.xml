<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- The namespace must match the fully qualified name of your repository interface -->
<mapper namespace="com.foodapp.promotion_service.persistence.repository.PromotionRepository">

    <!-- Define a reusable result map to map table columns to entity fields -->
    <resultMap id="PromotionResultMap" type="com.foodapp.promotion_service.persistence.entitty.PromotionEntity">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="description" column="description"/>
        <result property="status" column="status" typeHandler="org.apache.ibatis.type.EnumTypeHandler"/>
        <result property="startDate" column="start_date"/>
        <result property="endDate" column="end_date"/>
        <result property="createAt" column="created_at"/>
        <result property="updateAt" column="updated_at"/>
        <result property="version" column="version"/>
        <result property="createdBy" column="created_by"/>
        <result property="reviewedBy" column="reviewed_by"/>
        <result property="publishedBy" column="published_by"/>
        <result property="templateId" column="template_id"/>
    </resultMap>

    <!-- Implementation for the save() method -->
    <insert id="save" parameterType="com.foodapp.promotion_service.persistence.entitty.PromotionEntity">
        INSERT INTO promotion (id, name, description, status, start_date, end_date, created_at, updated_at, version, createdBy, reviewedBy, publishedBy, templateId)
        VALUES (#{id}, #{name}, #{description}, #{status, typeHandler=org.apache.ibatis.type.EnumTypeHandler}, #{startDate}, #{endDate}, #{createdAt}, #{updatedAt}, #{version}, #{createdBy}, #{reviewedBy}, #{publishBy}, #{templateId})
    </insert>

    <!-- Implementation for the findById() method -->
    <select id="findById" parameterType="string" resultType="com.foodapp.promotion_service.persistence.entitty.PromotionEntity">
        SELECT * FROM promotion WHERE id = #{id}
    </select>

    <!-- Implementation for the findByAll() method -->
    <select id="findByAll"
            resultType="com.foodapp.promotion_service.persistence.entity.PromotionEntity">
        SELECT * FROM promotion
    </select>

    <!-- Implementation for the findAll() method >
    <select id="findAll" resultMap="PromotionResultMap">
        SELECT * FROM promotions ORDER BY created_at DESC
    </select-->

    <!-- Implementation for the update() method with optimistic locking >
    <update id="update" parameterType="com.foodapp.promotion_service.persistence.entitty.PromotionEntity">
        UPDATE promotions
        SET
            name = #{name},
            description = #{description},
            status = #{status, typeHandler=org.apache.ibatis.type.EnumTypeHandler},
            start_date = #{startDate},
            end_date = #{endDate},
            update_at = #{updateAt},
            reviewed_by = #{reviewedBy},
            published_by = #{publishedBy},
            version = version + 1
        WHERE
            id = #{id} AND version = #{version}
    </update-->

</mapper>